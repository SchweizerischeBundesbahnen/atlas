{
  "$schema": "https://clew-resources.sbb-cloud.net/tekton-schema.json",
  "productName": "atlas",
  "advancedBuildSettings": {
    "buildWorkspaceSize": "25Gi",
    "buildCacheSize": "10Gi",
    "taggingWorkspaceSize": "2Gi",
    "pipelineTimeout": "1h30m0s"
  },
  "builder": {
    "java": "21",
    "node": "20"
  },
  "gradle": {
    "artifactoryMavenRepo": "atlas.mvn",
    "buildTaskName": "esta-gradle-build-extra-large"
  },
  "docker": [
    {
      "dockerFile": "line-directory/docker/Dockerfile",
      "imageName": "line-directory",
      "artifactoryDockerRepo": "atlas.docker"
    },
    {
      "dockerFile": "business-organisation-directory/docker/Dockerfile",
      "imageName": "business-organisation-directory",
      "artifactoryDockerRepo": "atlas.docker"
    },
    {
      "dockerFile": "service-point-directory/docker/Dockerfile",
      "imageName": "service-point-directory",
      "artifactoryDockerRepo": "atlas.docker"
    },
    {
      "dockerFile": "prm-directory/docker/Dockerfile",
      "imageName": "prm-directory",
      "artifactoryDockerRepo": "atlas.docker"
    },
    {
      "dockerFile": "import-service-point/docker/Dockerfile",
      "imageName": "import-service-point",
      "artifactoryDockerRepo": "atlas.docker"
    },
    {
      "dockerFile": "export-service-point/docker/Dockerfile",
      "imageName": "export-service-point",
      "artifactoryDockerRepo": "atlas.docker"
    },
    {
      "imageName": "mail",
      "dockerFile": "mail/docker/Dockerfile",
      "artifactoryDockerRepo": "atlas.docker"
    },
    {
      "imageName": "scheduling",
      "dockerFile": "scheduling/docker/Dockerfile",
      "artifactoryDockerRepo": "atlas.docker"
    },
    {
      "artifactoryDockerRepo": "atlas.docker",
      "dockerFile": "gateway/docker/Dockerfile",
      "imageName": "gateway"
    },
    {
      "dockerFile": "user-administration/docker/Dockerfile",
      "imageName": "user-administration",
      "artifactoryDockerRepo": "atlas.docker"
    },
    {
      "artifactoryDockerRepo": "atlas.docker",
      "dockerFile": "workflow/docker/Dockerfile",
      "imageName": "workflow"
    },
    {
      "artifactoryDockerRepo": "atlas.docker",
      "dockerFile": "location/docker/Dockerfile",
      "imageName": "location"
    },
    {
      "dockerFile": "api-auth-gateway/docker/Dockerfile",
      "imageName": "api-auth-gateway",
      "artifactoryDockerRepo": "atlas.docker"
    },
    {
      "dockerFile": "frontend/docker/Dockerfile",
      "imageName": "atlas-frontend",
      "artifactoryDockerRepo": "atlas.docker",
      "contextDir": "frontend"
    }
  ],
  "pipelines": [
    {
      "name": "continuous",
      "triggerType": [
        "GITEVENT"
      ],
      "branchNamePrefixes": [
        "feature"
      ],
      "build": {
        "testcontainers": {
          "enabled": true
        },
        "buildDockerImage": false,
        "additionalBuildParams": "-Dskip.npm.exec.ci=false -Dskip.npm.exec.build=false -Dskip.npm.exec.test=false -Dskip.npm.exec.ci=false -Dsonar.exclusions=**/node_modules/**,**/src/app/api/**,**/*.spec.ts,**/*.module.ts,**/*.routes.ts,**/karma.conf.js,**/instana.js,**/polyfills.ts,**/cypress/**,**/db/migration/**/*",
        "sonarScan": {
          "enabled": true
        },
        "failOnQualityGateFailure": true
      },
      "tasks": [
        {
          "name": "change-gradle-permissions",
          "taskRef": "esta-custom-exec",
          "params": {
            "SCRIPT": "chmod +x gradlew"
          },
          "runAfter": "git-clone"
        }
      ]
    },
    {
      "name": "manualRelease",
      "branchNamePrefixes": [
        "master"
      ],
      "tasks": [
        {
          "name": "change-gradle-permissions",
          "taskRef": "esta-custom-exec",
          "params": {
            "SCRIPT": "chmod +x gradlew"
          },
          "runAfter": "git-clone"
        },
        {
          "name": "atlas-start-deploy-dev-pipeline",
          "taskRef": "atlas-start-pipeline",
          "params": {
            "GIT_PROJECT": "KI_ATLAS",
            "GIT_REPOSITORY": "atlas-deploy-dev",
            "GIT_REVISION": "refs/heads/master",
            "PIPELINE_CONFIG_NAME": "continuous",
            "PIPELINE_PARAMETERS_JSON": "{\"VERSION_TO_DEPLOY\":\"${VERSION_TAG}\"}"
          },
          "runAfter": "maven-deploy"
        },
        {
          "name": "atlas-start-deploy-test-pipeline",
          "taskRef": "atlas-start-pipeline",
          "params": {
            "GIT_PROJECT": "KI_ATLAS",
            "GIT_REPOSITORY": "atlas-deploy-test",
            "GIT_REVISION": "refs/heads/master",
            "PIPELINE_CONFIG_NAME": "continuous",
            "PIPELINE_PARAMETERS_JSON": "{\"VERSION_TO_DEPLOY\":\"${VERSION_TAG}\"}"
          },
          "runAfter": "maven-deploy"
        }
      ],
      "triggerType": [
        "USER"
      ],
      "build": {
        "testcontainers": {
          "enabled": true
        },
        "buildDockerImage": true,
        "additionalBuildParams": "-Dskip.npm.exec.ci=false -Dskip.npm.exec.build=false -Dskip.npm.exec.publish=false -Dskip.npm.exec.test=false -Dskip.npm.exec.ci=false -DskipITs -Dsonar.exclusions=**/node_modules/**,**/src/app/api/**,**/*.spec.ts,**/*.module.ts,**/*.routes.ts,**/karma.conf.js,**/instana.js,**/polyfills.ts,**/cypress/**,**/db/migration/**/*",
        "sonarScan": {
          "enabled": true
        },
        "failOnQualityGateFailure": true,
        "owaspDependencyCheck": {
          "enabled": true,
          "additionalParams": "--disableNodeAudit --nodePackageSkipDevDependencies"
        }
      }
    },
    {
      "name": "taggingMinor",
      "enabled": true,
      "tagging": {
        "updateHelmChart": true,
        "versionIncrementPosition": "minor"
      },
      "branchNamePrefixes": [
        "master"
      ],
      "triggerType": [
        "GITEVENT"
      ]
    },
    {
      "name": "release",
      "triggerType": [
        "GITEVENT"
      ],
      "tasks": [
        {
          "name": "change-gradle-permissions",
          "taskRef": "esta-custom-exec",
          "params": {
            "SCRIPT": "chmod +x gradlew"
          },
          "runAfter": "git-clone"
        },
        {
          "name": "atlas-start-deploy-dev-pipeline",
          "taskRef": "atlas-start-pipeline",
          "params": {
            "GIT_PROJECT": "KI_ATLAS",
            "GIT_REPOSITORY": "atlas-deploy-dev",
            "GIT_REVISION": "refs/heads/master",
            "PIPELINE_CONFIG_NAME": "continuous",
            "PIPELINE_PARAMETERS_JSON": "{\"VERSION_TO_DEPLOY\":\"${VERSION_TAG}\"}"
          },
          "runAfter": "maven-deploy"
        },
        {
          "name": "atlas-start-deploy-test-pipeline",
          "taskRef": "atlas-start-pipeline",
          "params": {
            "GIT_PROJECT": "KI_ATLAS",
            "GIT_REPOSITORY": "atlas-deploy-test",
            "GIT_REVISION": "refs/heads/master",
            "PIPELINE_CONFIG_NAME": "continuous",
            "PIPELINE_PARAMETERS_JSON": "{\"VERSION_TO_DEPLOY\":\"${VERSION_TAG}\"}"
          },
          "runAfter": "maven-deploy"
        }
      ],
      "tagging": {
        "versionIncrementPosition": "minor"
      },
      "versionTagEventPatterns": [
        "^(\\d+\\.)?(\\d+\\.)?(\\*|\\d+)$"
      ],
      "build": {
        "testcontainers": {
          "enabled": true
        },
        "deployArtifacts": true,
        "buildDockerImage": true,
        "additionalBuildParams": "-Dskip.npm.exec.ci=false -Dskip.npm.exec.build=false -Dskip.npm.exec.publish=false -Dskip.npm.exec.test=false -Dskip.npm.exec.ci=false -DskipITs -Dsonar.exclusions=**/node_modules/**,**/src/app/api/**,**/*.spec.ts,**/*.module.ts,**/*.routes.ts,**/karma.conf.js,**/instana.js,**/polyfills.ts,**/cypress/**,**/db/migration/**/*",
        "sonarScan": {
          "releaseBranchName": "master",
          "enabled": true
        },
        "owaspDependencyCheck": {
          "enabled": true,
          "additionalParams": "--disableNodeAudit --nodePackageSkipDevDependencies"
        },
        "failOnQualityGateFailure": true
      }
    }
  ],
  "notifications": [
    {
      "type": "TEAMS",
      "enabled": true,
      "eventTypes": [
        "SUCCESS",
        "FAILURE",
        "ABORTED"
      ],
      "webhookSecretName": "esta-tekton-pipeline-env"
    }
  ]
}

