{
  "$schema": "https://esta-nginx-prod-release-code.app.obelix.otc.sbb.ch/code/projects/KD_ESTA/repos/esta-cloud-pipeline/raw/resources/estaCloudPipelineSchema.json?at=refs%2Ftags%2Frelease",
  "mainBranch": "master",
  "estaDebug": true,
  "hotfixBranch": "hotfix",
  "jdkLabel": "OpenJDK 17 64-Bit",
  "keepReleaseBuildLogsOnJenkins": true,
  "sendBuildStatusMail": false,
  "checkHumanCommits": false,
  "docker": [
    {
      "artifactoryDockerRepo": "atlas.docker",
      "openshiftAppName": "line-directory",
      "dockerFile": "line-directory/docker/Dockerfile",
      "artifactorySupressProjectSubfolderCreation": true
    },
    {
      "artifactoryDockerRepo": "atlas.docker",
      "openshiftAppName": "business-organisation-directory",
      "dockerFile": "business-organisation-directory/docker/Dockerfile",
      "artifactorySupressProjectSubfolderCreation": true
    },
    {
      "artifactoryDockerRepo": "atlas.docker",
      "openshiftAppName": "mail",
      "dockerFile": "mail/docker/Dockerfile",
      "artifactorySupressProjectSubfolderCreation": true
    },
    {
      "artifactoryDockerRepo": "atlas.docker",
      "openshiftAppName": "gateway",
      "dockerFile": "gateway/docker/Dockerfile",
      "artifactorySupressProjectSubfolderCreation": true
    },
    {
      "artifactoryDockerRepo": "atlas.docker",
      "openshiftAppName": "atlas-frontend",
      "dockerFile": "frontend/docker/Dockerfile",
      "artifactorySupressProjectSubfolderCreation": true
    }
  ],
  "helm": {
    "repository": "atlas.helm",
    "chartRootFolder": "./charts",
    "chart": "atlas",
    "release": "atlas"
  },
  "credentials": [
    {
      "id": "ssp-5y1zc40dv-j2u5-5cp4-9305-7bd11uoh6ch",
      "type": "string",
      "variable": "NPM_AUTH"
    },
    {
      "id": "ssp-1706i9d9g-7xuk-91z1-b95l-ybgaqd59h59",
      "type": "passwordVariable",
      "variable": "AMAZON-ACCESS-KEY"
    },
    {
      "id": "ssp-ns1048pd9-j1u8-c53r-4u04-86ko1jaf011",
      "type": "passwordVariable",
      "variable": "AMAZON-SECRET-KEY"
    },
    {
      "id": "bin.sbb.ch",
      "type": "usernamePassword",
      "usernameVariable": "ARTIFACTORY_USER",
      "passwordVariable": "ARTIFACTORY_PW"
    },
    {
      "type": "string",
      "id": "ssp-6slz1c1wa-b9r8-3t38-20bp-z8x1ch557uq",
      "variable": "KAFKA_AUTOMATION_CLIENT_SECRET"
    }
  ],
  "npm": {
    "targetRepo": "atlas.npm",
    "packageJson": "frontend/package.json",
    "additionalNpmScripts": "lint,build:ngssc,test"
  },
  "mvn": {
    "parentPom": "pom.xml",
    "deployableArtifactsPom": "pom.xml",
    "artifactoryMavenRepo": "atlas.mvn",
    "mavenLabel": "Apache Maven 3.8"
  },
  "stages": [
    {
      "stageName": "dev",
      "isOpenshiftDeploymentEnabled": true,
      "openshiftProject": "atlas-dev",
      "openshiftCluster": "aws_aws01t",
      "openshiftJenkinsCredentialsId": "e499fd92-711c-469b-9bc3-a67c748341d9",
      "preCiDeploymentJob": "",
      "postCiDeploymentJob": "",
      "api": {
        "artifactId": "apim-configuration",
        "instance": "int",
        "clientJenkinsId": "ssp-f1tqg4s8z-53a6-4h5d-0r0k-33j211k08b4",
        "clientId": "client-atlas-jenkins-dev",
        "classifier": "dev"
      },
      "kafkaDeployParameters": [
        {
          "environmentId": "test",
          "type": "topics",
          "fileGlob": "kafka/topics/dev/*.json",
          "clientId": "825e4030",
          "clientSecret": "${KAFKA_AUTOMATION_CLIENT_SECRET}",
          "providerId": "sc",
          "kafkaAutomationUrl": "https://automation-ng.kafka.sbb.ch"
        }
      ]
    },
    {
      "stageName": "test",
      "isOpenshiftDeploymentEnabled": true,
      "openshiftProject": "atlas-test",
      "openshiftCluster": "aws_aws01t",
      "openshiftJenkinsCredentialsId": "9f141b06-c73b-4697-bee6-167d6de558bb",
      "preCiDeploymentJob": "",
      "postCiDeploymentJob": "KI_ATLAS_E2E/atlas/master?successJob=KI_ATLAS/atlas/master",
      "api": {
        "artifactId": "apim-configuration",
        "instance": "int",
        "clientJenkinsId": "ssp-e2py25ozd-a12r-8xga-60s8-22did0rmx6s",
        "clientId": "client-atlas-jenkins-test",
        "classifier": "test"
      },
      "kafkaDeployParameters": [
        {
          "environmentId": "test",
          "type": "topics",
          "fileGlob": "kafka/topics/test/*.json",
          "clientId": "825e4030",
          "clientSecret": "${KAFKA_AUTOMATION_CLIENT_SECRET}",
          "providerId": "sc",
          "kafkaAutomationUrl": "https://automation-ng.kafka.sbb.ch"
        }
      ]
    },
    {
      "stageName": "int",
      "isOpenshiftDeploymentEnabled": true,
      "openshiftProject": "atlas-int",
      "openshiftCluster": "aws_maggie",
      "openshiftJenkinsCredentialsId": "3a6d45b4-ab76-467a-a970-44038a0120fd",
      "preCiDeploymentJob": "",
      "postCiDeploymentJob": "",
      "api": {
        "artifactId": "apim-configuration",
        "instance": "int",
        "clientJenkinsId": "ssp-dzyd7597p-wy82-j0i3-4ug5-17890eg89to",
        "clientId": "client-atlas-jenkins-int",
        "classifier": "int"
      },
      "kafkaDeployParameters": [
        {
          "environmentId": "inte",
          "type": "topics",
          "fileGlob": "kafka/topics/int/*.json",
          "clientId": "825e4030",
          "clientSecret": "${KAFKA_AUTOMATION_CLIENT_SECRET}",
          "providerId": "sc",
          "kafkaAutomationUrl": "https://automation-ng.kafka.sbb.ch"
        }
      ]
    },
    {
      "stageName": "prod",
      "isOpenshiftDeploymentEnabled": true,
      "openshiftProject": "atlas-prod",
      "openshiftCluster": "aws_maggie",
      "openshiftJenkinsCredentialsId": "ssp-p9d3z05co-ccn4-44b3-y824-1ut86c5e693",
      "preCiDeploymentJob": "",
      "postCiDeploymentJob": "",
      "preDeployConfirmUserMails": [
        "hannes.laner@sbb.ch",
        "antonio.romano@sbb.ch",
        "luca.ammann2@sbb.ch",
        "joel.hofer@sbb.ch",
        "marek.stankala@sbb.ch"
      ],
      "api": {
        "artifactId": "apim-configuration",
        "instance": "prod",
        "clientJenkinsId": "ssp-ijzyow7em-c2c6-cd77-kwoi-7vt28p07a93",
        "clientId": "client-atlas-jenkins-prod"
      },
      "kafkaDeployParameters": [
        {
          "environmentId": "prod",
          "type": "topics",
          "fileGlob": "kafka/topics/prod/*.json",
          "clientId": "825e4030",
          "clientSecret": "${KAFKA_AUTOMATION_CLIENT_SECRET}",
          "providerId": "sc",
          "kafkaAutomationUrl": "https://automation-ng.kafka.sbb.ch"
        }
      ]
    }
  ],
  "teamsNotifications": {
    "url": "https://sbb.webhook.office.com/webhookb2/e262e9dc-5836-4c36-b3e5-0e827f2a2787@2cda5d11-f0ac-46b3-967d-af1b2e1bd01a/JenkinsCI/1d957b31eb2c46aeac8003d5a70e1926/8231c64b-bcb4-497e-93bf-0213ebdac9e4",
    "startNotification": false,
    "notifySuccess": true,
    "notifyAborted": true,
    "notifyNotBuilt": true,
    "notifyUnstable": true,
    "notifyFailure": true,
    "notifyBackToNormal": true,
    "notifyRepeatedFailure": true
  },
  "steps": [
    {
      "stepType": "continuous",
      "isBuildEnabled": true,
      "branchNamePrefixes": [
        "feature",
        "bugfix"
      ],
      "additionalBuildParams": "-Dskip.npm.exec.ci=false -Dskip.npm.exec.build=false",
      "additionalBuildParamsForSonarScan": "-DskipTests=true -Dskip.npm.exec.ci=true -Dskip.npm.exec.build=true -Dskip.npm.exec.publish=true -DskipITs -Dsonar.exclusions=**/node_modules/**,**/src/app/api/**,**/*.spec.ts,**/*.module.ts,**/*.routes.ts,**/karma.conf.js,**/instana.js,**/polyfills.ts",
      "sonarScanEnabled": true,
      "junitTestReportPath": "**/target/surefire-reports/*.xml"
    },
    {
      "stepType": "release",
      "isBuildEnabled": true,
      "failOnXrayScan": true,
      "sonarScanEnabled": true,
      "additionalBuildParamsForSonarScan": "-DskipTests=true -Dskip.npm.exec.ci=true -Dskip.npm.exec.build=true -Dskip.npm.exec.publish=true -DskipITs -Dsonar.exclusions=**/node_modules/**,**/src/app/api/**,**/*.spec.ts,**/*.module.ts,**/*.routes.ts,**/karma.conf.js,**/instana.js,**/polyfills.ts",
      "staging": {
        "stagingType": "simple",
        "stages": [
          "dev",
          "test"
        ]
      },
      "dependencyCheckEnabled": true,
      "failOnQualityGateFailure": true,
      "junitTestReportPath": "**/target/surefire-reports/*.xml",
      "additionalBuildParams": "-Dskip.npm.exec.ci=false -Dskip.npm.exec.build=false -Dskip.npm.exec.publish=false -DskipITs",
      "triggerBuildOnCommitEnabled": true,
      "hotfixCreationEnabled": false
    }
  ]
}
